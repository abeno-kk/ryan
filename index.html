<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å››å¹´ç´šï½œçœŸåˆ†æ•¸èˆ‡å‡åˆ†æ•¸ç·´ç¿’</title>
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --gray-100: #f5f5f5;
      --gray-200: #e5e5e5;
      --gray-300: #d4d4d4;
      --gray-700: #374151;
      --gray-900: #111827;
      --success: #10b981;
      --error: #ef4444;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family:sans-serif; background:var(--gray-100); color:var(--gray-900); }
    .container { max-width: 840px; margin:0 auto; padding:1rem; }
    h1 { font-size:1.5rem; margin:0.5rem 0 0.25rem; }
    h2 { font-size:1.25rem; margin:1rem 0 0.5rem; }
    p { margin:0.25rem 0; line-height:1.5; }
    .nav { display:flex; flex-wrap:wrap; gap:.5rem; margin-bottom:1rem; }
    .nav button{ padding:.4rem .8rem; border:1px solid var(--gray-300); border-radius:.375rem; background:#fff; color:var(--gray-900); cursor:pointer; font-size:.9rem; transition:background .2s;}
    .nav button:hover{ background:var(--gray-200);}
    .nav button.active{ background:var(--primary); color:#fff; border-color:var(--primary-dark); }
    .modebar{ margin-bottom:1rem;}
    .question{ margin-bottom:1rem;}
    .question h3{ font-size:1.1rem; margin-bottom:.5rem;}
    .input-row{ display:flex; align-items:center; flex-wrap:wrap; gap:.5rem; margin-bottom:.5rem;}
    .input-row input[type="number"], .input-row input[type="text"]{ width:4rem; padding:.4rem; border:1px solid var(--gray-300); border-radius:.375rem; font-size:1rem;}
    .input-row button.option{ padding:.4rem .7rem; border:1px solid var(--gray-300); border-radius:.375rem; background:#fff; cursor:pointer; font-size:1rem; transition:background .2s;}
    .input-row button.option.selected{ background:var(--primary); color:#fff; border-color:var(--primary-dark); }
    .btn{ display:inline-block; padding:.5rem 1rem; border-radius:.375rem; border:none; background:var(--primary); color:#fff; font-size:1rem; cursor:pointer; transition:background .2s;}
    .btn:hover{ background:var(--primary-dark);}
    .feedback{ margin-top:.5rem; font-weight:bold;}
    .feedback.success{ color:var(--success); }
    .feedback.error{ color:var(--error); }

    /* è¦–è¦ºåŒ–é•·æ¢ */
    .bar-container{ display:flex; flex-wrap:wrap; gap:.25rem; margin:.5rem 0;}
    .bar{ display:flex; gap:.1rem;}
    .cell{ width:24px; height:24px; border:1px solid var(--gray-300); border-radius:.125rem; background:var(--gray-200); }
    .cell.filled{ background:var(--primary); }

    /* æ•¸ç·š */
    .numberline{ margin:1rem 0; width:100%; height:60px; }

    /* è¨˜éŒ„é¢æ¿ */
    .record-panel{ position:fixed; bottom:1rem; right:1rem; z-index:100; }
    .record-button{ position:fixed; bottom:1.5rem; right:1.5rem; background:var(--primary); color:#fff; border:none; border-radius:50%; width:48px; height:48px; font-size:1.5rem; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 4px 6px rgba(0,0,0,.1); }
    .record-modal{ position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.4); display:none; align-items:center; justify-content:center; }
    .record-modal.active{ display:flex; }
    .record-modal .panel{ background:#fff; max-width:90%; max-height:90%; overflow-y:auto; padding:1rem; border-radius:.5rem; }
    .record-modal .panel h3{ margin-top:0; }
    .record-modal table{ border-collapse:collapse; width:100%; margin-top:.5rem;}
    .record-modal td, .record-modal th{ border:1px solid var(--gray-300); padding:.4rem; font-size:.85rem;}

    /* é€²åº¦æ¢ */
    .progress-wrapper{ width:100%; height:8px; background:var(--gray-300); border-radius:4px; margin-bottom:4px; overflow:hidden;}
    .progress-bar{ height:100%; background:var(--primary); border-radius:4px; width:0;}
    .progress-text{ font-size:.9rem; margin-bottom:.5rem;}

    /* è¦–è¦ºåˆ†æ•¸ï¼ˆåƒä½ è²¼çš„åœ–ï¼‰ */
    .frac{ display:inline-flex; flex-direction:column; align-items:center; line-height:1; margin:0 .2rem; }
    .frac .top,.frac .bottom{ font-weight:700; font-size:1.35em; }
    .frac.xl .top,.frac.xl .bottom{ font-size:1.75em; }
    .frac .bar{ width:1.5em; height:2px; background:#222; margin:.2rem 0; }
    .mix { display:inline-flex; align-items:center; gap:.3rem; }
    .mix .whole{ font-weight:700; font-size:1.15em; }

    @media (max-width: 600px){
      h1{ font-size:1.25rem;}
      .nav button{ font-size:.8rem; }
      .input-row input[type="number"], .input-row input[type="text"]{ width:3rem; }
      .frac .top,.frac .bottom{ font-size:1.2em; }
      .frac.xl .top,.frac.xl .bottom{ font-size:1.5em; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>å››å¹´ç´šï½œçœŸåˆ†æ•¸èˆ‡å‡åˆ†æ•¸ ç·´ç¿’</h1>
    <p>æ¯å¤© 10 é¡Œï¼Œé¡Œç›®ä¸é‡è¤‡ï¼›å…ˆçœ‹æ‡‚çœŸåˆ†æ•¸ã€å‡åˆ†æ•¸ã€å¸¶åˆ†æ•¸ï¼Œå†é–‹å§‹é—–é—œï¼</p>
    <div class="nav" id="nav"></div>
    <div id="main"></div>
  </div>

  <!-- ä»Šæ—¥ç´€éŒ„ -->
  <div class="record-panel">
    <button class="record-button" id="recordBtn">ğŸ“’</button>
  </div>
  <div class="record-modal" id="recordModal">
    <div class="panel">
      <h3>ä»Šå¤©çš„ç·´ç¿’ç´€éŒ„</h3>
      <div id="recordContent"></div>
      <button class="btn" id="closeRecord">é—œé–‰</button>
    </div>
  </div>

  <script>
  (function(){
    /* ========= å·¥å…·ï¼šè¦–è¦ºåˆ†æ•¸/æ··åˆæ•¸ ========= */
    function fracHTML(n, d, size='lg'){
      return `<span class="frac ${size==='xl'?'xl':''}">
        <span class="top">${n}</span>
        <span class="bar"></span>
        <span class="bottom">${d}</span>
      </span>`;
    }
    function mixHTML(w, n, d, size='lg'){
      return `<span class="mix"><span class="whole">${w}</span>åˆ ${fracHTML(n,d,size)}</span>`;
    }

    /* ========= äº‚æ•¸èˆ‡æ—¥æœŸ ========= */
    function mulberry32(a){ return function(){ let t=a+=0x6D2B79F5; t=Math.imul(t^t>>>15,t|1); t^=t+Math.imul(t^t>>>7,t|61); return ((t^t>>>14)>>>0)/4294967296; } }
    function getTodayStr(){ const d=new Date(); const yyyy=d.getFullYear(); const mm=String(d.getMonth()+1).padStart(2,'0'); const dd=String(d.getDate()).padStart(2,'0'); return `${yyyy}${mm}${dd}`; }

    const state={ mode:'warmup', idx:0, score:0, questions:[], rng:null, seed:0, attempt:1, logKey:'', sessionDetails:[] };

    function loadAttempt(){ const key='frac-attempt-'+getTodayStr(); return parseInt(localStorage.getItem(key)||'0',10); }
    function saveAttempt(num){ const key='frac-attempt-'+getTodayStr(); localStorage.setItem(key,String(num)); }
    function saveSessionRecord(record){ const logKey='frac-log-'+getTodayStr(); let list=[]; try{ list=JSON.parse(localStorage.getItem(logKey)||'[]'); }catch(e){} list.push(record); localStorage.setItem(logKey,JSON.stringify(list)); }
    function getSessionRecords(){ const logKey='frac-log-'+getTodayStr(); try{ return JSON.parse(localStorage.getItem(logKey)||'[]'); }catch(e){ return []; } }

    /* ========= é¡Œåº«ç”¢ç”Ÿ ========= */
    function generateBasicQuestions(count){
      const qs=[]; const categories=['judge','imp2mix','mix2imp'];
      for(let i=0;i<count;i++){
        const type=categories[i%categories.length];
        if(type==='judge'){
          let d=Math.floor(state.rng()*7)+6; // 6-12
          let n=Math.floor(state.rng()*20)+1; // 1-20ï¼ˆå¯è¶…éåˆ†æ¯ï¼‰
          qs.push({type:'judge', n,d, correct:(n<d)?'proper':(n===d?'equal':'improper')});
        }else if(type==='imp2mix'){
          let d=Math.floor(state.rng()*7)+4; // 4-10
          let whole=Math.floor(state.rng()*4)+2; // 2-5
          let rem=Math.floor(state.rng()*d)+1; // 1..d
          let n=whole*d+rem;
          qs.push({type:'imp2mix', n,d, whole, rem});
        }else if(type==='mix2imp'){
          let d=Math.floor(state.rng()*7)+3; // 3-9
          let whole=Math.floor(state.rng()*4)+2; // 2-5
          let rem=Math.floor(state.rng()*(d-1))+1; // 1..d-1
          let n=whole*d+rem;
          qs.push({type:'mix2imp', whole, nPart:rem, d, n});
        }
      }
      for(let i=qs.length-1;i>0;i--){ const j=Math.floor(state.rng()*(i+1)); [qs[i],qs[j]]=[qs[j],qs[i]]; }
      return qs;
    }

    function generateAdvancedQuestions(count){
      const qs=[]; const categories=['visualMulti','compare','numberLine'];
      for(let i=0;i<count;i++){
        const type=categories[i%categories.length];
        if(type==='visualMulti'){
          let d=Math.floor(state.rng()*8)+5; // 5-12
          let max=d*(Math.floor(state.rng()*2)+2); // 2æˆ–3æ¢
          let n=Math.floor(state.rng()*max)+1;
          qs.push({type:'visualMulti', n,d});
        }else if(type==='compare'){
          let d1=Math.floor(state.rng()*9)+3, d2=Math.floor(state.rng()*9)+3;
          let n1=Math.floor(state.rng()*d1*2)+1, n2=Math.floor(state.rng()*d2*2)+1;
          let v1=n1/d1, v2=n2/d2;
          let sign=Math.abs(v1-v2)<1e-9?'=':(v1>v2?'>':'<');
          qs.push({type:'compare', n1,d1,n2,d2, correct:sign});
        }else if(type==='numberLine'){
          let units=Math.floor(state.rng()*2)+1; // 1-2
          let d=Math.floor(state.rng()*5)+2; // 2-6
          let total=d*units+1;
          let idx=Math.floor(state.rng()*(total-2))+1;
          let n=idx;
          qs.push({type:'numberLine', units, d, idx, correct:{n,d}});
        }
      }
      for(let i=qs.length-1;i>0;i--){ const j=Math.floor(state.rng()*(i+1)); [qs[i],qs[j]]=[qs[j],qs[i]]; }
      return qs;
    }

    function generateAppliedQuestions(count){
      const qs=[]; const categories=['appliedPack','appliedShaded','appliedInterval'];
      for(let i=0;i<count;i++){
        const type=categories[i%categories.length];
        if(type==='appliedPack'){
          let d=Math.floor(state.rng()*5)+4; // 4-8
          let maxN=d*(Math.floor(state.rng()*2)+2);
          let n=Math.floor(state.rng()*maxN)+1;
          let whole=Math.floor(n/d), rem=n%d;
          qs.push({type:'appliedPack', d,n, whole, rem});
        }else if(type==='appliedShaded'){
          let d=Math.floor(state.rng()*6)+3; // 3-8
          let n=Math.floor(state.rng()*(d*2))+1; // 1..2d
          let relation=n<d?'<':(n===d?'=':'>');
          qs.push({type:'appliedShaded', d,n, relation});
        }else if(type==='appliedInterval'){
          // â˜… æ”¹ç‚º 1â€“5 éš¨æ©Ÿï¼Œå†å– [a, a+1] å€é–“
          let a=Math.floor(state.rng()*5)+1; // 1..5
          let b=a+1;
          const options=[]; let correctCount=0; const totalOptions=6;
          for(let j=0;j<totalOptions;j++){
            let denom=Math.floor(state.rng()*8)+3; // 3-10
            let whole=Math.floor(state.rng()*3); // 0-2
            let numer=Math.floor(state.rng()*denom);
            if(numer===0 && whole===0) numer=1;
            const value=(whole*denom+numer)/denom;
            const text=(whole>0?`${whole} `:'')+`${numer}/${denom}`;
            const isCorrect=(value>a && value<b);
            if(isCorrect) correctCount++;
            options.push({text, correct:isCorrect});
          }
          if(!correctCount){
            let denom=Math.floor(state.rng()*4)+3; let numer=Math.floor(denom*0.5);
            options[0]={text:`${numer}/${denom}`, correct:true};
          }
          qs.push({type:'appliedInterval', a,b, options});
        }
      }
      for(let i=qs.length-1;i>0;i--){ const j=Math.floor(state.rng()*(i+1)); [qs[i],qs[j]]=[qs[j],qs[i]]; }
      return qs;
    }

    /* ========= å°èˆªèˆ‡æš–èº« ========= */
    function renderNav(){
      const nav=document.getElementById('nav'); nav.innerHTML='';
      const modes=[ {id:'warmup',label:'æš–èº«æ•™å­¸'}, {id:'basic',label:'åŸºæœ¬ç·´ç¿’'}, {id:'advanced',label:'é€²éšç·´ç¿’'}, {id:'applied',label:'æ‡‰ç”¨ç·´ç¿’'} ];
      modes.forEach(m=>{
        const btn=document.createElement('button');
        btn.textContent=m.label; btn.dataset.mode=m.id; if(state.mode===m.id) btn.classList.add('active');
        btn.addEventListener('click',()=>{
          state.mode=m.id;
          if(m.id==='warmup'){ renderNav(); renderWarmup(); }
          else { initPractice(m.id); }
        });
        nav.appendChild(btn);
      });
    }

    function renderWarmup(){
      const main=document.getElementById('main'); main.innerHTML='';
      const div=document.createElement('div');
      div.innerHTML=`
        <h2>æš–èº«æ•™å­¸</h2>
        <p>å…ˆçœ‹æ‡‚ä¸€å€‹ä¾‹å­ï¼Œå†é–‹å§‹ç·´ç¿’ï¼</p>
        <div style="border:1px solid var(--gray-300); border-radius:.5rem; padding:1rem; margin-bottom:1rem;">
          <h3>ä»€éº¼æ˜¯çœŸåˆ†æ•¸ï¼Ÿ</h3>
          <p>æŠŠä¸€æ ¹é•·æ¢å¹³å‡åˆ†æˆ <b>5 ç­‰ä»½</b>ï¼ˆåˆ†æ¯ï¼‰ï¼Œå¡—ä¸Š <b>3 ä»½</b>ï¼ˆåˆ†å­ï¼‰ï¼Œå¯«æˆåˆ†æ•¸ï¼š<span id="p-frac"></span>ã€‚å› ç‚º <b>3 &lt; 5</b>ï¼Œæ‰€ä»¥æ˜¯ <span style="color:var(--success); font-weight:bold;">çœŸåˆ†æ•¸</span>ã€‚</p>
          <div class="bar-container" id="warmup-proper-bar"></div>
        </div>
        <div style="border:1px solid var(--gray-300); border-radius:.5rem; padding:1rem; margin-bottom:1rem;">
          <h3>ä»€éº¼æ˜¯å‡åˆ†æ•¸ï¼Ÿä»€éº¼æ˜¯å¸¶åˆ†æ•¸ï¼Ÿ</h3>
          <p>å‡åˆ†æ•¸çš„åˆ†å­æ¯”åˆ†æ¯å¤§ã€‚ä¾‹å¦‚åˆ†æ•¸ <span id="ex-imp"></span> å¯ä»¥æ›æˆå¸¶åˆ†æ•¸ <span id="ex-mix"></span>ï¼Œå› ç‚º <b>13 Ã· 5 = 2</b> é¤˜ <b>3</b>ã€‚</p>
          <p>å†çœ‹å¦ä¸€å€‹ä¾‹å­ï¼šå‡åˆ†æ•¸ <span id="ex-imp2"></span> å¯ä»¥æ›æˆ <span id="ex-mix2"></span>ã€‚ä¸‹åœ–é¡¯ç¤ºä¸‰å€‹å®Œæ•´çš„é•·æ¢ï¼Œå†åŠ ä¸Šä¸€å€‹é•·æ¢å¡—äº† 3 ä»½ï¼Œä¾¿æ˜¯ <span id="ex-mix2-again"></span>ã€‚</p>
          <div class="bar-container" id="warmup-improper-bar"></div>
        </div>
        <button class="btn" id="startPractice">é–‹å§‹ç·´ç¿’ï¼</button>
      `;
      document.getElementById('main').appendChild(div);
      // å¡«çœŸåˆ†æ•¸ 3/5
      div.querySelector('#p-frac').innerHTML = fracHTML(3,5);
      // 13/5 = 2 åˆ 3/5
      div.querySelector('#ex-imp').innerHTML = fracHTML(13,5);
      div.querySelector('#ex-mix').innerHTML = mixHTML(2,3,5);
      // 15/4 = 3 åˆ 3/4
      div.querySelector('#ex-imp2').innerHTML = fracHTML(15,4);
      div.querySelector('#ex-mix2').innerHTML = mixHTML(3,3,4);
      div.querySelector('#ex-mix2-again').innerHTML = mixHTML(3,3,4);

      // åœ–ç¤ºï¼š3/5
      const properWrap=div.querySelector('#warmup-proper-bar');
      const bar1=document.createElement('div'); bar1.className='bar';
      for(let i=0;i<5;i++){ const c=document.createElement('div'); c.className='cell'; if(i<3) c.classList.add('filled'); bar1.appendChild(c); }
      properWrap.appendChild(bar1);

      // åœ–ç¤ºï¼š15/4
      const improperWrap=div.querySelector('#warmup-improper-bar');
      const denom=4,total=15, full=Math.floor(total/denom), remainder=total%denom;
      for(let i=0;i<full;i++){ const b=document.createElement('div'); b.className='bar'; for(let j=0;j<denom;j++){ const c=document.createElement('div'); c.className='cell filled'; b.appendChild(c); } improperWrap.appendChild(b); }
      if(remainder>0){ const b=document.createElement('div'); b.className='bar'; for(let j=0;j<denom;j++){ const c=document.createElement('div'); c.className='cell'; if(j<remainder) c.classList.add('filled'); b.appendChild(c); } improperWrap.appendChild(b); }

      div.querySelector('#startPractice').onclick=()=>{ state.mode='basic'; initPractice('basic'); };
    }

    /* ========= åˆå§‹åŒ–ç·´ç¿’ ========= */
    function initPractice(mode){
      renderNav();
      let attempt=loadAttempt()+1; saveAttempt(attempt); state.attempt=attempt;
      const seedStr=getTodayStr()+attempt; let seedInt=0; for(let i=0;i<seedStr.length;i++){ seedInt=(seedInt*31+seedStr.charCodeAt(i))>>>0; }
      state.seed=seedInt; state.rng=mulberry32(seedInt);
      state.idx=0; state.score=0; state.sessionDetails=[]; state.mode=mode;

      const count=10;
      if(mode==='basic') state.questions=generateBasicQuestions(count);
      else if(mode==='advanced') state.questions=generateAdvancedQuestions(count);
      else if(mode==='applied') state.questions=generateAppliedQuestions(count);
      else state.questions=generateBasicQuestions(count);

      state.logKey='frac-log-'+getTodayStr();
      renderCurrentQuestion();
    }

    /* ========= é¡Œç›®æ¸²æŸ“ ========= */
    function renderCurrentQuestion(){
      const main=document.getElementById('main'); main.innerHTML='';
      const progressWrapper=document.createElement('div'); progressWrapper.className='progress-wrapper';
      const progressBar=document.createElement('div'); progressBar.className='progress-bar'; progressBar.style.width=((state.idx)/state.questions.length*100)+'%';
      progressWrapper.appendChild(progressBar);
      const progressText=document.createElement('div'); progressText.className='progress-text'; progressText.textContent=`ç¬¬ ${state.idx+1} / ${state.questions.length} é¡Œ`;
      main.appendChild(progressWrapper); main.appendChild(progressText);

      const idx=state.idx; if(idx>=state.questions.length){ finishPractice(); return; }
      const q=state.questions[idx];

      const container=document.createElement('div'); container.className='question';
      const title=document.createElement('h3');

      /* åœ–åƒå¼åˆ†æ•¸æ¨™é¡Œ */
      if(q.type==='judge'){ title.innerHTML = `åˆ¤æ–·ï¼š ${fracHTML(q.n,q.d,'xl')}`; }
      else if(q.type==='imp2mix'){ title.innerHTML = `å°‡ ${fracHTML(q.n,q.d,'xl')} è½‰æ›ç‚ºå¸¶åˆ†æ•¸`; }
      else if(q.type==='mix2imp'){ title.innerHTML = `å°‡ ${q.whole} ${fracHTML(q.nPart,q.d,'xl')} è½‰æ›æˆå‡åˆ†æ•¸`; }
      else if(q.type==='visualMulti'){ title.textContent = `çœ‹åœ–å¯«å‡ºåˆ†æ•¸ (åˆ†æ¯ ${q.d})`; }
      else if(q.type==='compare'){ title.innerHTML = `æ¯”è¼ƒå¤§å°ï¼š ${fracHTML(q.n1,q.d1,'xl')} ï¼Ÿ ${fracHTML(q.n2,q.d2,'xl')}`; }
      else if(q.type==='numberLine'){ title.textContent = 'æ•¸ç·šå¡«ç©ºï¼šè«‹å¡«å…¥ç´…é»æ‰€ä»£è¡¨çš„åˆ†æ•¸'; }
      /* â˜…è£œä¸Šæ‡‰ç”¨é¡Œå‹çš„é¡Œå¹¹ */
      else if(q.type==='appliedPack'){ title.textContent = 'æ‡‰ç”¨ï¼šæŠŠåœ–ç¤ºå¯«æˆå¸¶åˆ†æ•¸'; }
      else if(q.type==='appliedShaded'){ title.textContent = 'æ‡‰ç”¨ï¼šä¾é™°å½±åˆ†æ•¸èˆ‡ 1 çš„å¤§å°é—œä¿‚ä½œç­”'; }
      else if(q.type==='appliedInterval'){ title.textContent = `æ‡‰ç”¨ï¼šé¸å‡ºä»‹æ–¼ ${q.a} å’Œ ${q.b} ä¹‹é–“çš„åˆ†æ•¸ï¼ˆå¯è¤‡é¸ï¼‰`; }
      container.appendChild(title);

      let hint='';
      if(q.type==='judge'){ hint='é¡Œç›®èªªæ˜ï¼šè«‹å¾ä¸‹é¢é¸æ“‡ã€ŒçœŸåˆ†æ•¸ã€æˆ–ã€Œå‡åˆ†æ•¸ã€ã€‚'; }
      else if(q.type==='imp2mix'){ hint='é¡Œç›®èªªæ˜ï¼šè«‹è¼¸å…¥ã€Œæ•´æ•¸ã€åˆ†å­ã€åˆ†æ¯ã€ï¼Œå†æŒ‰é€å‡ºã€‚'; }
      else if(q.type==='mix2imp'){ hint='é¡Œç›®èªªæ˜ï¼šè«‹è¼¸å…¥æ–°çš„ã€Œåˆ†å­ã€åˆ†æ¯ã€ï¼Œå†æŒ‰é€å‡ºã€‚'; }
      else if(q.type==='visualMulti'){ hint='é¡Œç›®èªªæ˜ï¼šè«‹çœ‹åœ–è¼¸å…¥è—è‰²æ ¼å­ç¸½æ•¸ä½œç‚ºã€Œåˆ†å­ã€ï¼Œåˆ†æ¯å·²å›ºå®šç‚º '+q.d+'ï¼Œå†æŒ‰é€å‡ºã€‚'; }
      else if(q.type==='compare'){ hint='é¡Œç›®èªªæ˜ï¼šè«‹é¸æ“‡ã€Œ>ã€ã€Œ<ã€æˆ–ã€Œ=ã€ã€‚'; }
      else if(q.type==='numberLine'){ hint='é¡Œç›®èªªæ˜ï¼šè«‹è¼¸å…¥ç´…é»å°æ‡‰çš„ã€Œåˆ†å­ã€ï¼Œåˆ†æ¯ç‚º '+q.d+'ï¼›å¦‚æœåˆ†å­å¤§æ–¼ç­‰æ–¼åˆ†æ¯ä»£è¡¨è¶…é 1ã€‚'; }
      /* â˜…è£œä¸Šæ‡‰ç”¨é¡Œå‹çš„æç¤º */
      else if(q.type==='appliedPack'){ hint='é¡Œç›®èªªæ˜ï¼šè«‹è¼¸å…¥å¸¶åˆ†æ•¸çš„ã€Œæ•´æ•¸ã€åˆ†å­ã€ï¼ˆåˆ†æ¯å·²å›ºå®šï¼‰ï¼Œå†æŒ‰é€å‡ºã€‚'; }
      else if(q.type==='appliedShaded'){ hint='é¡Œç›®èªªæ˜ï¼šè«‹è¼¸å…¥åˆ†å­ï¼ˆåˆ†æ¯å·²å›ºå®šï¼‰ä¸¦é¸æ“‡èˆ‡ 1 çš„é—œä¿‚ç¬¦è™Ÿã€‚'; }
      else if(q.type==='appliedInterval'){ hint='é¡Œç›®èªªæ˜ï¼šè«‹å‹¾é¸æ‰€æœ‰ä»‹æ–¼å·¦ã€å³ç«¯é»ä¹‹é–“çš„åˆ†æ•¸ï¼ˆå¯è¤‡é¸ï¼‰ã€‚'; }
      const hintP=document.createElement('p'); hintP.style.background='var(--gray-200)'; hintP.style.padding='.5rem'; hintP.style.borderRadius='.375rem'; hintP.style.marginBottom='.5rem'; hintP.textContent=hint;
      container.appendChild(hintP);

      const inputRow=document.createElement('div'); inputRow.className='input-row';
      const feedback=document.createElement('div'); feedback.className='feedback';

      container.appendChild(inputRow);

      /* å„é¡Œå‹äº’å‹•ï¼ˆåŸæ¨£ä¿ç•™ï¼‰ */
      if(q.type==='judge'){
        const btnProper=document.createElement('button'); btnProper.textContent='çœŸåˆ†æ•¸'; btnProper.className='option';
        const btnImproper=document.createElement('button'); btnImproper.textContent='å‡åˆ†æ•¸'; btnImproper.className='option';
        inputRow.appendChild(btnProper); inputRow.appendChild(btnImproper);
        const submitBtn=document.createElement('button'); submitBtn.textContent='é€å‡º'; submitBtn.className='btn';
        container.appendChild(submitBtn); container.appendChild(feedback);
        submitBtn.onclick=()=>{
          let choice=null;
          if(btnProper.classList.contains('selected')) choice='proper';
          else if(btnImproper.classList.contains('selected')) choice='improper';
          if(!choice){ feedback.textContent='è«‹å…ˆé¸æ“‡ç­”æ¡ˆ'; feedback.className='feedback error'; return; }
          const correct=q.correct;
          if(correct==='equal'){
            if(choice==='improper'){ state.score++; feedback.textContent='ç­”å°äº†ï¼'; feedback.className='feedback success'; }
            else{ feedback.textContent='ç­”æ¡ˆæ˜¯ã€Œå‡åˆ†æ•¸ã€ï¼ˆæˆ–æ•´æ•¸ï¼‰ã€‚'; feedback.className='feedback error'; }
            state.sessionDetails.push({type:'judge', question:`${q.n}/${q.d}`, user:choice, correct:'å‡åˆ†æ•¸', ok:choice==='improper'});
          }else{
            const ok=(correct==='proper' && choice==='proper') || (correct==='improper' && choice==='improper');
            if(ok){ state.score++; feedback.textContent='ç­”å°äº†ï¼'; feedback.className='feedback success'; }
            else{ feedback.textContent=`ç­”éŒ¯äº†ï¼Œæ­£ç¢ºæ˜¯ã€Œ${correct==='proper'?'çœŸåˆ†æ•¸':'å‡åˆ†æ•¸'}ã€ã€‚`; feedback.className='feedback error'; }
            state.sessionDetails.push({type:'judge', question:`${q.n}/${q.d}`, user:choice==='proper'?'çœŸåˆ†æ•¸':'å‡åˆ†æ•¸', correct:correct==='proper'?'çœŸåˆ†æ•¸':'å‡åˆ†æ•¸', ok:ok});
          }
          setTimeout(()=>{ state.idx++; renderCurrentQuestion(); },900);
        };
        btnProper.onclick=()=>{ btnProper.classList.add('selected'); btnImproper.classList.remove('selected'); };
        btnImproper.onclick=()=>{ btnImproper.classList.add('selected'); btnProper.classList.remove('selected'); };
      }
      else if(q.type==='imp2mix'){
        const wInput=document.createElement('input'); wInput.type='number'; wInput.placeholder='æ•´æ•¸'; wInput.min=0; wInput.style.width='4rem';
        const nInput=document.createElement('input'); nInput.type='number'; nInput.placeholder='åˆ†å­'; nInput.min=0;
        const dInput=document.createElement('input'); dInput.type='number'; dInput.placeholder='åˆ†æ¯'; dInput.min=1;
        inputRow.appendChild(wInput); inputRow.appendChild(document.createTextNode(' ')); inputRow.appendChild(nInput); inputRow.appendChild(document.createTextNode('/')); inputRow.appendChild(dInput);
        const submitBtn=document.createElement('button'); submitBtn.textContent='é€å‡º'; submitBtn.className='btn';
        container.appendChild(submitBtn); container.appendChild(feedback);
        submitBtn.onclick=()=>{
          const W=parseInt(wInput.value,10), N=parseInt(nInput.value,10), D=parseInt(dInput.value,10);
          if(isNaN(W)||isNaN(N)||isNaN(D)||D<=0){ feedback.textContent='è«‹è¼¸å…¥å®Œæ•´æ•¸å€¼'; feedback.className='feedback error'; return; }
          const ok=(W===q.whole && N===q.rem && D===q.d);
          if(ok){ state.score++; feedback.innerHTML='ç­”å°äº†ï¼'; feedback.className='feedback success'; }
          else{ feedback.innerHTML=`ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç‚º ${mixHTML(q.whole,q.rem,q.d)}`; feedback.className='feedback error'; }
          state.sessionDetails.push({type:'imp2mix', question:`${q.n}/${q.d}`, user:`${W} ${N}/${D}`, correct:`${q.whole} ${q.rem}/${q.d}`, ok:ok});
          setTimeout(()=>{ state.idx++; renderCurrentQuestion(); },900);
        };
      }
      else if(q.type==='mix2imp'){
        const barsWrap=document.createElement('div'); barsWrap.className='bar-container';
        const denom=q.d, total=q.n, fullBars=Math.floor(total/denom), remainder=total%denom;
        for(let i=0;i<fullBars;i++){ const bar=document.createElement('div'); bar.className='bar'; for(let j=0;j<denom;j++){ const cell=document.createElement('div'); cell.className='cell filled'; bar.appendChild(cell); } barsWrap.appendChild(bar); }
        if(remainder>0){ const bar=document.createElement('div'); bar.className='bar'; for(let j=0;j<denom;j++){ const cell=document.createElement('div'); cell.className='cell'; if(j<remainder) cell.classList.add('filled'); bar.appendChild(cell); } barsWrap.appendChild(bar); }
        container.appendChild(barsWrap);

        const nInput=document.createElement('input'); nInput.type='number'; nInput.placeholder='åˆ†å­'; nInput.min=0;
        const dInput=document.createElement('input'); dInput.type='number'; dInput.placeholder='åˆ†æ¯'; dInput.min=1;
        inputRow.appendChild(nInput); inputRow.appendChild(document.createTextNode('/')); inputRow.appendChild(dInput);
        const submitBtn=document.createElement('button'); submitBtn.textContent='é€å‡º'; submitBtn.className='btn';
        container.appendChild(submitBtn); container.appendChild(feedback);
        submitBtn.onclick=()=>{
          const N=parseInt(nInput.value,10), D=parseInt(dInput.value,10);
          if(isNaN(N)||isNaN(D)||D<=0){ feedback.textContent='è«‹è¼¸å…¥å®Œæ•´æ•¸å€¼'; feedback.className='feedback error'; return; }
          const ok=(N===q.n && D===q.d);
          if(ok){ state.score++; feedback.innerHTML='ç­”å°äº†ï¼'; feedback.className='feedback success'; }
          else{ feedback.innerHTML=`ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç‚º ${fracHTML(q.n,q.d)}`; feedback.className='feedback error'; }
          state.sessionDetails.push({type:'mix2imp', question:`${q.whole} ${q.nPart}/${q.d}`, user:`${N}/${D}`, correct:`${q.n}/${q.d}`, ok:ok});
          setTimeout(()=>{ state.idx++; renderCurrentQuestion(); },900);
        };
      }
      else if(q.type==='visualMulti'){
        const wrap=document.createElement('div'); wrap.className='bar-container';
        let whole=Math.floor(q.n/q.d), rem=q.n%q.d;
        for(let i=0;i<whole;i++){ const bar=document.createElement('div'); bar.className='bar'; for(let j=0;j<q.d;j++){ const c=document.createElement('div'); c.className='cell filled'; bar.appendChild(c);} wrap.appendChild(bar); }
        if(rem>0){ const bar=document.createElement('div'); bar.className='bar'; for(let j=0;j<q.d;j++){ const c=document.createElement('div'); c.className='cell'; if(j<rem) c.classList.add('filled'); bar.appendChild(c);} wrap.appendChild(bar); }
        container.appendChild(wrap);

        const nInput=document.createElement('input'); nInput.type='number'; nInput.placeholder='åˆ†å­'; nInput.min=0;
        const dInput=document.createElement('input'); dInput.type='number'; dInput.value=q.d; dInput.readOnly=true; dInput.style.background='#f0f0f0';
        inputRow.appendChild(nInput); inputRow.appendChild(document.createTextNode('/')); inputRow.appendChild(dInput);
        const submitBtn=document.createElement('button'); submitBtn.textContent='é€å‡º'; submitBtn.className='btn';
        container.appendChild(submitBtn); container.appendChild(feedback);
        submitBtn.onclick=()=>{
          const N=parseInt(nInput.value,10);
          if(isNaN(N)){ feedback.textContent='è«‹è¼¸å…¥åˆ†å­'; feedback.className='feedback error'; return; }
          const ok=(N===q.n);
          if(ok){ state.score++; feedback.innerHTML='ç­”å°äº†ï¼'; feedback.className='feedback success'; }
          else{ feedback.innerHTML=`ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç‚º ${fracHTML(q.n,q.d)}`; feedback.className='feedback error'; }
          state.sessionDetails.push({type:'visualMulti', question:`${q.n}/${q.d}`, user:`${N}/${q.d}`, correct:`${q.n}/${q.d}`, ok:ok});
          setTimeout(()=>{ state.idx++; renderCurrentQuestion(); },900);
        };
      }
      else if(q.type==='compare'){
        const btnGT=document.createElement('button'); btnGT.textContent='>'; btnGT.className='option';
        const btnEQ=document.createElement('button'); btnEQ.textContent='='; btnEQ.className='option';
        const btnLT=document.createElement('button'); btnLT.textContent='<'; btnLT.className='option';
        inputRow.appendChild(btnGT); inputRow.appendChild(btnEQ); inputRow.appendChild(btnLT);
        const submitBtn=document.createElement('button'); submitBtn.textContent='é€å‡º'; submitBtn.className='btn';
        container.appendChild(submitBtn); container.appendChild(feedback);
        let choice=null;
        function select(b,val){ btnGT.classList.remove('selected'); btnEQ.classList.remove('selected'); btnLT.classList.remove('selected'); b.classList.add('selected'); choice=val; }
        btnGT.onclick=()=>select(btnGT,'>'); btnEQ.onclick=()=>select(btnEQ,'='); btnLT.onclick=()=>select(btnLT,'<');
        submitBtn.onclick=()=>{
          if(!choice){ feedback.textContent='è«‹å…ˆé¸æ“‡é—œä¿‚'; feedback.className='feedback error'; return; }
          const ok=(choice===q.correct);
          if(ok){ state.score++; feedback.textContent='ç­”å°äº†ï¼'; feedback.className='feedback success'; }
          else{ feedback.textContent=`ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç‚º ${q.correct}`; feedback.className='feedback error'; }
          state.sessionDetails.push({type:'compare', question:`${q.n1}/${q.d1} ? ${q.n2}/${q.d2}`, user:choice, correct:q.correct, ok:ok});
          setTimeout(()=>{ state.idx++; renderCurrentQuestion(); },900);
        };
      }
      else if(q.type==='numberLine'){
        const svg=document.createElementNS('http://www.w3.org/2000/svg','svg'); svg.classList.add('numberline'); svg.setAttribute('width','100%'); svg.setAttribute('height','60');
        const width=600, height=60, d=q.d, units=q.units, totalTicks=d*units+1, startX=20, endX=width-20, lineY=40, step=(endX-startX)/(totalTicks-1);
        const line=document.createElementNS('http://www.w3.org/2000/svg','line'); line.setAttribute('x1',startX); line.setAttribute('y1',lineY); line.setAttribute('x2',endX); line.setAttribute('y2',lineY); line.setAttribute('stroke','#555'); line.setAttribute('stroke-width','2'); svg.appendChild(line);
        for(let i=0;i<totalTicks;i++){ const x=startX+i*step; const tick=document.createElementNS('http://www.w3.org/2000/svg','line'); tick.setAttribute('x1',x); tick.setAttribute('y1',lineY); tick.setAttribute('x2',x); tick.setAttribute('y2',lineY-8); tick.setAttribute('stroke','#555'); tick.setAttribute('stroke-width','2'); svg.appendChild(tick);
          if(i%d===0){ const text=document.createElementNS('http://www.w3.org/2000/svg','text'); text.setAttribute('x',x); text.setAttribute('y',lineY+15); text.setAttribute('font-size','12'); text.setAttribute('text-anchor','middle'); text.textContent=i/d; svg.appendChild(text); } }
        const px=startX+q.idx*step; const circle=document.createElementNS('http://www.w3.org/2000/svg','circle'); circle.setAttribute('cx',px); circle.setAttribute('cy',lineY-12); circle.setAttribute('r','6'); circle.setAttribute('fill', getComputedStyle(document.documentElement).getPropertyValue('--primary') || '#6366f1'); svg.appendChild(circle);
        container.appendChild(svg);

        const nInput=document.createElement('input'); nInput.type='number'; nInput.placeholder='åˆ†å­'; nInput.min=0;
        const dInput=document.createElement('input'); dInput.type='number'; dInput.value=q.d; dInput.readOnly=true; dInput.style.background='#f0f0f0';
        inputRow.appendChild(nInput); inputRow.appendChild(document.createTextNode('/')); inputRow.appendChild(dInput);
        const submitBtn=document.createElement('button'); submitBtn.textContent='é€å‡º'; submitBtn.className='btn';
        container.appendChild(submitBtn); container.appendChild(feedback);
        submitBtn.onclick=()=>{
          const N=parseInt(nInput.value,10); if(isNaN(N)){ feedback.textContent='è«‹è¼¸å…¥åˆ†å­'; feedback.className='feedback error'; return; }
          const ok=(N===q.correct.n);
          if(ok){ state.score++; feedback.innerHTML='ç­”å°äº†ï¼'; feedback.className='feedback success'; }
          else{ feedback.innerHTML=`ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç‚º ${fracHTML(q.correct.n,q.correct.d)}`; feedback.className='feedback error'; }
          state.sessionDetails.push({type:'numberLine', question:`${q.correct.n}/${q.correct.d}`, user:`${N}/${q.correct.d}`, correct:`${q.correct.n}/${q.correct.d}`, ok:ok});
          setTimeout(()=>{ state.idx++; renderCurrentQuestion(); },900);
        };
      }
      else if(q.type==='appliedPack'){
        const barsWrap=document.createElement('div'); barsWrap.className='bar-container';
        let whole=Math.floor(q.n/q.d), rem=q.n%q.d;
        for(let i=0;i<whole;i++){ const bar=document.createElement('div'); bar.className='bar'; for(let j=0;j<q.d;j++){ const c=document.createElement('div'); c.className='cell filled'; bar.appendChild(c);} barsWrap.appendChild(bar); }
        if(rem>0){ const bar=document.createElement('div'); bar.className='bar'; for(let j=0;j<q.d;j++){ const c=document.createElement('div'); c.className='cell'; if(j<rem) c.classList.add('filled'); bar.appendChild(c);} barsWrap.appendChild(bar); }
        container.appendChild(barsWrap);

        const wInput=document.createElement('input'); wInput.type='number'; wInput.placeholder='æ•´æ•¸'; wInput.min=0;
        const rInput=document.createElement('input'); rInput.type='number'; rInput.placeholder='åˆ†å­'; rInput.min=0;
        const dInput=document.createElement('input'); dInput.type='number'; dInput.value=q.d; dInput.readOnly=true; dInput.style.background='#f0f0f0';
        inputRow.appendChild(wInput); inputRow.appendChild(document.createTextNode(' ')); inputRow.appendChild(rInput); inputRow.appendChild(document.createTextNode('/')); inputRow.appendChild(dInput);
        const submitBtn=document.createElement('button'); submitBtn.textContent='é€å‡º'; submitBtn.className='btn';
        container.appendChild(submitBtn); container.appendChild(feedback);
        submitBtn.onclick=()=>{
          const W=parseInt(wInput.value,10), R=parseInt(rInput.value,10);
          if(isNaN(W)||isNaN(R)){ feedback.textContent='è«‹è¼¸å…¥å®Œæ•´æ•¸å€¼'; feedback.className='feedback error'; return; }
          const ok=(W===q.whole && R===q.rem);
          if(ok){ state.score++; feedback.innerHTML='ç­”å°äº†ï¼'; feedback.className='feedback success'; }
          else{ feedback.innerHTML=`ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç‚º ${mixHTML(q.whole,q.rem,q.d)}`; feedback.className='feedback error'; }
          state.sessionDetails.push({type:'appliedPack', question:`ç®±å¤§å°${q.d}ï¼Œå…±æœ‰${q.n}`, user:`${W} ${R}/${q.d}`, correct:`${q.whole} ${q.rem}/${q.d}`, ok:ok});
          setTimeout(()=>{ state.idx++; renderCurrentQuestion(); },900);
        };
      }
      else if(q.type==='appliedShaded'){
        const barsWrap=document.createElement('div'); barsWrap.className='bar-container';
        let whole=Math.floor(q.n/q.d), rem=q.n%q.d;
        for(let i=0;i<whole;i++){ const bar=document.createElement('div'); bar.className='bar'; for(let j=0;j<q.d;j++){ const c=document.createElement('div'); c.className='cell filled'; bar.appendChild(c);} barsWrap.appendChild(bar); }
        if(rem>0){ const bar=document.createElement('div'); bar.className='bar'; for(let j=0;j<q.d;j++){ const c=document.createElement('div'); c.className='cell'; if(j<rem) c.classList.add('filled'); bar.appendChild(c);} barsWrap.appendChild(bar); }
        container.appendChild(barsWrap);

        const nInput=document.createElement('input'); nInput.type='number'; nInput.placeholder='åˆ†å­'; nInput.min=0;
        const dInput=document.createElement('input'); dInput.type='number'; dInput.value=q.d; dInput.readOnly=true; dInput.style.background='#f0f0f0';
        inputRow.appendChild(nInput); inputRow.appendChild(document.createTextNode('/')); inputRow.appendChild(dInput);
        const btnGT=document.createElement('button'); btnGT.textContent='>'; btnGT.className='option';
        const btnEQ=document.createElement('button'); btnEQ.textContent='='; btnEQ.className='option';
        const btnLT=document.createElement('button'); btnLT.textContent='<'; btnLT.className='option';
        inputRow.appendChild(btnGT); inputRow.appendChild(btnEQ); inputRow.appendChild(btnLT);
        const submitBtn=document.createElement('button'); submitBtn.textContent='é€å‡º'; submitBtn.className='btn';
        container.appendChild(submitBtn); container.appendChild(feedback);
        let choice=null; function selectSign(b,v){ btnGT.classList.remove('selected'); btnEQ.classList.remove('selected'); btnLT.classList.remove('selected'); b.classList.add('selected'); choice=v; }
        btnGT.onclick=()=>selectSign(btnGT,'>'); btnEQ.onclick=()=>selectSign(btnEQ,'='); btnLT.onclick=()=>selectSign(btnLT,'<');
        submitBtn.onclick=()=>{
          const N=parseInt(nInput.value,10); if(isNaN(N)||choice===null){ feedback.textContent='è«‹è¼¸å…¥åˆ†å­ä¸¦é¸æ“‡é—œä¿‚'; feedback.className='feedback error'; return; }
          const ok=(N===q.n && choice===q.relation);
          if(ok){ state.score++; feedback.innerHTML='ç­”å°äº†ï¼'; feedback.className='feedback success'; }
          else{ feedback.innerHTML=`ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç‚º ${fracHTML(q.n,q.d)} ä¸”é—œä¿‚ ${q.relation}`; feedback.className='feedback error'; }
          state.sessionDetails.push({type:'appliedShaded', question:`${q.n}/${q.d}`, user:`${N}/${q.d} ${choice}`, correct:`${q.n}/${q.d} ${q.relation}`, ok:ok});
          setTimeout(()=>{ state.idx++; renderCurrentQuestion(); },900);
        };
      }
      else if(q.type==='appliedInterval'){
        const listDiv=document.createElement('div'); listDiv.style.display='flex'; listDiv.style.flexWrap='wrap'; listDiv.style.gap='.5rem';
        q.options.forEach((opt,i)=>{ const label=document.createElement('label'); label.style.display='flex'; label.style.alignItems='center'; label.style.cursor='pointer';
          const cb=document.createElement('input'); cb.type='checkbox'; cb.dataset.index=i; cb.style.marginRight='.25rem'; label.appendChild(cb); label.appendChild(document.createTextNode(opt.text)); listDiv.appendChild(label); });
        container.appendChild(listDiv);
        const submitBtn=document.createElement('button'); submitBtn.textContent='é€å‡º'; submitBtn.className='btn';
        container.appendChild(submitBtn); container.appendChild(feedback);
        submitBtn.onclick=()=>{
          let ok=true; const userSelected=[]; const inputs=listDiv.querySelectorAll('input[type="checkbox"]');
          inputs.forEach((cb,idx)=>{ const isChecked=cb.checked; const correct=q.options[idx].correct; if(isChecked) userSelected.push(q.options[idx].text); if(isChecked!==correct) ok=false; });
          if(ok){ state.score++; feedback.textContent='ç­”å°äº†ï¼'; feedback.className='feedback success'; }
          else{ const correctList=q.options.filter(o=>o.correct).map(o=>o.text).join(', '); feedback.textContent=`ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆç‚ºï¼š${correctList}`; feedback.className='feedback error'; }
          state.sessionDetails.push({type:'appliedInterval', question:`ç¯„åœ${q.a}åˆ°${q.b}`, user:userSelected, correct:q.options.filter(o=>o.correct).map(o=>o.text), ok:ok});
          setTimeout(()=>{ state.idx++; renderCurrentQuestion(); },1200);
        };
      }

      main.appendChild(container);
    }

    /* ========= å®Œæˆç¸½çµ ========= */
    function finishPractice(){
      const main=document.getElementById('main'); main.innerHTML='';
      const summary=document.createElement('div');
      summary.innerHTML=`<h2>ä»Šå¤©å®Œæˆï¼</h2><p>ä½ ç­”å°äº† ${state.score} é¡Œï¼Œå…± ${state.questions.length} é¡Œã€‚</p>`;
      const now=new Date(); const timeStr=String(now.getHours()).padStart(2,'0')+':'+String(now.getMinutes()).padStart(2,'0');
      saveSessionRecord({ time:timeStr, score:state.score, total:state.questions.length, details:state.sessionDetails });

      const btnAgain=document.createElement('button'); btnAgain.className='btn'; btnAgain.textContent='å†ç·´ä¸€æ¬¡';
      btnAgain.onclick=()=>{ initPractice(state.mode); };
      const btnBack=document.createElement('button'); btnBack.className='btn'; btnBack.style.marginLeft='.5rem'; btnBack.textContent='å›æš–èº«æ•™å­¸';
      btnBack.onclick=()=>{ state.mode='warmup'; renderNav(); renderWarmup(); };
      summary.appendChild(btnAgain); summary.appendChild(btnBack);
      main.appendChild(summary);
    }

    /* ========= è¨˜éŒ„é¢æ¿ ========= */
    function showRecordPanel(){
      const records=getSessionRecords(); const content=document.getElementById('recordContent');
      if(!records.length){ content.innerHTML='<p>å°šç„¡ç´€éŒ„ã€‚</p>'; }
      else{
        let html='<table><tr><th>æ™‚é–“</th><th>å¾—åˆ†</th><th>ç¸½é¡Œæ•¸</th></tr>';
        records.slice().reverse().forEach(r=>{ html+=`<tr><td>${r.time}</td><td>${r.score}</td><td>${r.total}</td></tr>`; });
        html+='</table>'; content.innerHTML=html;
      }
      document.getElementById('recordModal').classList.add('active');
    }

    /* ========= åˆå§‹ ========= */
    renderNav(); renderWarmup();
    document.getElementById('recordBtn').onclick=showRecordPanel;
    document.getElementById('closeRecord').onclick=()=>{ document.getElementById('recordModal').classList.remove('active'); };
  })();
  </script>
</body>
</html>
